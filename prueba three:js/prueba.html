<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first Three.js app</title>
		<style>
			body {
				color: #000;
				font-family:Monospace;
				font-size:13px;
				margin: 0px;
				overflow: hidden;
			}

			button {
				color: rgb(255,255,255);
				background: transparent;
				border: 0px;
				padding: 5px 10px;
				cursor: pointer;
			}
			button:hover {
				background-color: rgba(0,255,255,0.5);
			}
			
			#menu {
				position: absolute;
				bottom: 20px;
				width: 100%;
				text-align: center;
				padding: 0;
				margin: 0;
			}

			#topmenu {
				position: absolute;
				top: 10px;
				right: 10px;
				width: 100%;
				text-align: right;
				padding: 0;
				margin: 0;
				z-index: 1;
			}

			#info {
				position: absolute;
				top: 0px; width: 100%;
				text-align:center;
				padding: 5px;
			}


		</style>
	</head>
	<body>

		<div id="topmenu"></div>


		<script src="build/three.min.js"></script>
		<script src="js/libs/stats.min.js"></script>
		<script src="js/libs/dat.gui.min.js"></script>
		<script src="js/controls/OrbitControls.js"></script>
		<script src="js/shaders/OceanShaders.js"></script>
		<script src="js/Ocean.js"></script>
		<script src="js/Mirror.js"></script>
		<script src="js/WaterShader.js"></script>

		
		<script>
			// Our Javascript will go here.

			// need scene, camera and renderer
			var scene = new THREE.Scene();

			var width = window.innerWidth
			var height = window.innerHeight

			var huevos = [];

			var lastTime = (new Date()).getTime();
			
			var menu = document.getElementById( "topmenu" );

			var camera = new THREE.PerspectiveCamera( 75, width/height, 0.1, 1000 );

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			var geometrySphere = new THREE.SphereGeometry( 1.6, 32, 32 );
			var materialSphere = new THREE.MeshBasicMaterial( );

			var buttonAddHuevo = document.createElement( 'button' );
			buttonAddHuevo.innerHTML = "Nuevo huevo";
			menu.appendChild( buttonAddHuevo );
			buttonAddHuevo.addEventListener( 'click', function() { 
										var sphere = new THREE.Mesh( geometrySphere, materialSphere );
										sphere.position.y = -3.4
										sphere.position.x = 9
										huevos.push( sphere );
										scene.add( sphere );
										console.log(sphere)
										// mesh.scale.set(2,2,2)
														 } );

			var buttonDeleteHuevo = document.createElement( 'button' );
			buttonDeleteHuevo.innerHTML = "Eliminar huevos";
			menu.appendChild( buttonDeleteHuevo );
			buttonDeleteHuevo.addEventListener( 'click', function() {
											for ( var i = 0; i < huevos.length; i ++ ) {
												console.log( huevos[i].uuid  )
												scene.remove( huevos[i] );
											}
											huevos = [];
											console.log(huevos.length)
														 } );


			//var b_ab = document.getElementById( "b_ab" );
			//b_ab.addEventListener( 'click', function() { visualizationType = 2; showAtomsBonds() } );

			var geometryCyl = new THREE.CylinderGeometry(3, 1.7, 10, 20, 20, true );
			var material =  new THREE.MeshBasicMaterial( { 
								color: 0x3794cf, 
								wireframe: true,
								//wireframeLinewidth: 10, 
								transparent: true, 
								opacity: 0.2,
								 } ); 
			var cylinder = new THREE.Mesh( geometryCyl, material ); 
			scene.add( cylinder );

			var material = new THREE.MeshBasicMaterial({ color: 0x3794cf });
			var radius = 1.7;
			var segments = 32;
			var circleGeometry = new THREE.CircleGeometry( radius, segments );
			var circle = new THREE.Mesh( circleGeometry, material );
			circle.rotation.x = 4.7
			circle.position.y = -5
			scene.add( circle );
			

			var Water =
			{
				Initialize: function () {
					//this.ms_Camera.position.set(450, 350, 450);
					
					var gsize = 512;
					var res = 1024;
					var gres = res / 2;
					var origx = -gsize / 2;
					var origz = -gsize / 2;
					this.ms_Ocean = new THREE.Ocean(renderer, camera, scene,
					{
						USE_HALF_FLOAT : 'half-float',
						INITIAL_SIZE : 256.0,
						INITIAL_WIND : [10.0, 10.0],
						INITIAL_CHOPPINESS : 1.5,
						CLEAR_COLOR : [1.0, 1.0, 1.0, 0.0],
						GEOMETRY_ORIGIN : [origx, origz],
						SUN_DIRECTION : [-1.0, 1.0, 1.0],
						OCEAN_COLOR: new THREE.Vector3(0.004, 0.016, 0.047),
						SKY_COLOR: new THREE.Vector3(3.2, 9.6, 12.8),
						EXPOSURE : 0.35,
						GEOMETRY_RESOLUTION: gres,
						GEOMETRY_SIZE : gsize,
						RESOLUTION : res
					});
					this.ms_Ocean.materialOcean.uniforms.u_projectionMatrix = { type: "m4", value: camera.projectionMatrix };
					this.ms_Ocean.materialOcean.uniforms.u_viewMatrix = { type: "m4", value: camera.matrixWorldInverse };
					this.ms_Ocean.materialOcean.uniforms.u_cameraPosition = { type: "v3", value: camera.position };
					scene.add(this.ms_Ocean.oceanMesh);
					
				},

				Update: function () {
					var currentTime = new Date().getTime();
					this.ms_Ocean.deltaTime = (currentTime - lastTime) / 1000 || 0.0;
					lastTime = currentTime;
					this.ms_Ocean.render(this.ms_Ocean.deltaTime); //
					this.ms_Ocean.overrideMaterial = this.ms_Ocean.materialOcean;
					if (this.ms_Ocean.changed) {
						this.ms_Ocean.materialOcean.uniforms.u_size.value = this.ms_Ocean.size;
						this.ms_Ocean.materialOcean.uniforms.u_sunDirection.value.set( this.ms_Ocean.sunDirectionX, this.ms_Ocean.sunDirectionY, this.ms_Ocean.sunDirectionZ );
						this.ms_Ocean.materialOcean.uniforms.u_exposure.value = this.ms_Ocean.exposure;
						this.ms_Ocean.changed = false;
					}
					this.ms_Ocean.materialOcean.uniforms.u_normalMap.value = this.ms_Ocean.normalMapFramebuffer ;
					this.ms_Ocean.materialOcean.uniforms.u_displacementMap.value = this.ms_Ocean.displacementMapFramebuffer ;
					this.ms_Ocean.materialOcean.uniforms.u_projectionMatrix.value = camera.projectionMatrix ;
					this.ms_Ocean.materialOcean.uniforms.u_viewMatrix.value = camera.matrixWorldInverse ;
					this.ms_Ocean.materialOcean.uniforms.u_cameraPosition.value = camera.position;
					this.ms_Ocean.materialOcean.depthTest = true;
					
				},
				// no se usa
				Resize: function (inWidth, inHeight) {
					camera.aspect = inWidth / inHeight;
					camera.updateProjectionMatrix();
					renderer.setSize(inWidth, inHeight);
					
				}
			};

/*
			////////////
			// CUSTOM //
			////////////
			
			this.refractSphereCamera = new THREE.CubeCamera( 0.1, 5000, 512 );
			scene.add( refractSphereCamera );

			var fShader = THREE.FresnelShader;
			
			var fresnelUniforms = 
			{
				"mRefractionRatio": { type: "f", value: 1.02 },
				"mFresnelBias": 	{ type: "f", value: 0.1 },
				"mFresnelPower": 	{ type: "f", value: 2.0 },
				"mFresnelScale": 	{ type: "f", value: 1.0 },
				"tCube": 			{ type: "t", value: refractSphereCamera.renderTarget } //  textureCube }
			};
			
			// create custom material for the shader
			var customMaterial = new THREE.ShaderMaterial( 
			{
			    uniforms: 		fresnelUniforms,
				vertexShader:   fShader.vertexShader,
				fragmentShader: fShader.fragmentShader
			}   );
			
			var sphereGeometry = new THREE.SphereGeometry( 100, 64, 32 );
			this.sphere = new THREE.Mesh( sphereGeometry, customMaterial );
			sphere.position.set(0, 50, 100);
			scene.add(sphere);
			
			refractSphereCamera.position = sphere.position;


*/

			

			controls = new THREE.OrbitControls( camera );
			controls.enableDamping = true;
			controls.dampingFactor = 1;
			controls.enableZoom = true;
			controls.enablePan = false;
			controls.maxDistance = 50.0;
			controls.maxPolarAngle = Math.PI * 0.495;

			camera.position.z = 25;

			var render = function () {
				requestAnimationFrame( render ); //loop

				/*cube.rotation.x += 0.01;
				cube.rotation.y += 0.01;*/

				controls.update();
				
				Water.Update();

				renderer.render(scene, camera);
			};

			Water.Initialize();
			
			render();


		</script>
	</body>
</html>